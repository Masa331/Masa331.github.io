<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Separate logic from view | Masa331 blog</title>

    <link rel="stylesheet" href="http://masa331.github.io/assets/stylesheets/pygment_trac.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/stylesheets/styles.css">

    <script async defer src="http://masa331.github.io/assets/javascripts/twitter-widget.js"></script>
    <script async defer src="https://buttons.github.io/buttons.js"></script>

    <meta name="viewport" content="width=device-width">
  </head>

  <body>
    <div class="container">
      <nav class="d-flex pt-3 pb-3 mb-3">
        <div class="mr-auto lead">
          <a href="http://masa331.github.io/" class="logo">Přemysl Donát</a>
        </div>
      </nav>

      <div class="row mb-3">
        <div class="col-sm-8">
          <h1 id="separate-logic-from-view">Separate logic from view</h1>

          <p>I decided i want to change some internal logic in <a href="https://github.com/Masa331/suptasks">SupTasks</a>. Right now tasks are completed when they have true in ‘completed’ column in database. I want them to be completed when they have tag ‘completed’.</p>

          <p>I’v been thinking what i will have to do in order to implement this. Well, one thing will be dropping the ‘completed’ column. The bad thing is i use automatically generated getter for this column in views to determine if the task is completed or not.</p>

          <h2 id="current-situation">Current situation</h2>

          <div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Task</span> <span class="o">&lt;</span> <span class="no">Sequel</span><span class="o">::</span><span class="no">Model</span>
  <span class="c1"># nothing in here, only autogenerated getter #completed</span>
<span class="k">end</span>

<span class="c1"># ... later in template:</span>

<span class="o">&lt;</span><span class="sx">% if </span><span class="vi">@task</span><span class="o">.</span><span class="n">completed</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;span&gt;</span><span class="no">Completed</span><span class="o">!&lt;</span><span class="sr">/span&gt;</span>
<span class="sr">&lt;% end %&gt;</span></code></pre></div>

          <p>Now when i drop the column the getter disappears and without modification the view will break.</p>

          <h2 id="better-version">Better version</h2>

          <p>This is how it should look like:</p>

          <div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">Task</span> <span class="o">&lt;</span> <span class="no">Sequel</span><span class="o">::</span><span class="no">Model</span>
  <span class="c1"># custom written method</span>
  <span class="k">def</span> <span class="nf">completed?</span>
    <span class="n">completed</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="c1"># ... later in template:</span>

<span class="o">&lt;</span><span class="sx">% if </span><span class="vi">@task</span><span class="o">.</span><span class="n">completed?</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;span&gt;</span><span class="no">Completed</span><span class="o">!&lt;</span><span class="sr">/span&gt;</span>
<span class="sr">&lt;% end %&gt;</span></code></pre></div>

          <p>Now when i drop the column <strong>i only have to change code at one place</strong> in model. No changes in views at all.</p>

          <p>So i refactored it here in this commit: <a href="https://github.com/Masa331/suptasks/commit/b762ee91e35b6137bf0a195f4acc35156711e597">b762ee9</a></p>

          <p>It might look like not that much necessarry in such small project(only 2 changes now). But when you work on bigger projects this approach can save you some real production trouble when you overlook that 20nth place it’s used somewhere in view.</p>

          <h2 id="changing-the-logic-now-doesnt-affect-any-view">Changing the logic now doesn’t affect any view</h2>

          <p>And now when changing the logic i didn’t need to touch that view with <code>task.completed?</code> inside. It’s here in this commit: <a href="https://github.com/Masa331/suptasks/commit/07e8a4d09ee24bc609e54c48fcf7eaae3a75b794">07e8a4d</a></p>

          <p>If you looked into the commit, i actually had to touch html form for making the task completed. And it makes me wonder, should i also change it to only point to action which knows how to make task complete instead of updating task attributes directly? What do you think?</p>

          <div id="disqus_thread"></div>
          <script async defer src="http://masa331.github.io/assets/javascripts/disqus-widget.js"></script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

        </div>

<div class="col-sm-4">
  <h2>About me</h2>

  <p>Hi, i'm Přemysl Donát and this is a place where i share things i find interesting.</p>

  <p>This is my picture:</p>
  <img src="http://masa331.github.io/assets/images/my-picture.png" alt="Premysl Donat at Balaton lake" class="img-fluid" />
  <br />
  <br />
  <p>I'm a web developer. I love and believe in Ruby and the ecosystem around it but i'm also fine with React and other more full-stack things. I really enjoyed Elm. Right now i'm learning Solidity development and blockchain projects. If i had more free time i would like to try Pony, Rust, and plain C.</p>

  <p>I work at <s> <a href="http://uol.cz">UOL</a></s> <a href="http://topmonks.com">topmonks.com</a>. I also have my own tiny company named <a href="http://imagineanything.cz">Imagine Anything</a> under which i run few side projects.</p>

  <p>One of these side projects is <a href="https://damedata.cz">DameData.cz</a>. It's a web app which helps you to easily connect your business with accounting(czech market only right now). Please check it out and get in touch if you have anything on your mind. It's a project which solves various pain points i experienced in my previous employment and most of my free time is dedicated to it:</p>

  <a href="https://damedata.cz">
    <img src="http://masa331.github.io/assets/images/logo_v2.png" alt="DameData.cz logo" class="img-fluid" />
  </a>

  <br />
  <br />

  <p>If you are interested in more personal things and you want to get to know me, then, well, you have to get to know me!</p>

  <p>Have a good one, Přemek</p>
  <a class="twitter-follow-button" href="https://twitter.com/DonatP" data-size="large" data-show-count="false">Follow @DonatP</a>
  <a class="github-button" href="https://github.com/Masa331" data-size="large" aria-label="Follow @Masa331 on GitHub">Follow @Masa331</a>
</div>
      </div>

      <footer class="pt-2 pb-2">
        <span class="text-muted">Přemysl Donát © 2018</span>
      </footer>
    </div>
  </body>
</html>
